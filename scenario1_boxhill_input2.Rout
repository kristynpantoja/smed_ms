
R version 4.0.3 (2020-10-10) -- "Bunny-Wunnies Freak Out"
Copyright (C) 2020 The R Foundation for Statistical Computing
Platform: x86_64-pc-linux-gnu (64-bit)

R is free software and comes with ABSOLUTELY NO WARRANTY.
You are welcome to redistribute it under certain conditions.
Type 'license()' or 'licence()' for distribution details.

  Natural language support but running in an English locale

R is a collaborative project with many contributors.
Type 'contributors()' for more information and
'citation()' on how to cite R or R packages in publications.

Type 'demo()' for some demos, 'help()' for on-line help, or
'help.start()' for an HTML browser interface to help.
Type 'q()' to quit R.

> ################################################################################
> # last updated: 03/04/2021
> # purpose: to create a list of seqmed simulations for scenario 1:
> #   squared exponential vs. matern,
> #   where the true function is matern
> 
> ################################################################################
> # Sources/Libraries
> ################################################################################
> output_home = "run_designs/updated_simulations/gp/boxhill"
> functions_home = "functions"
> 
> # for seqmed design
> source(paste(functions_home, "/SeqMEDgp.R", sep = ""))
> source(paste(functions_home, "/SeqMEDgp_batch.R", sep = ""))
> source(paste(functions_home, "/charge_function_q.R", sep = ""))
> source(paste(functions_home, "/covariance_functions.R", sep = ""))
> source(paste(functions_home, "/wasserstein_distance.R", sep = ""))
> source(paste(functions_home, "/gp_predictive.R", sep = ""))
> 
> # for box-hill design
> source(paste(functions_home, "/boxhill.R", sep = ""))
> source(paste(functions_home, "/boxhill_gp.R", sep = ""))
> source(paste(functions_home, "/kl_divergence.R", sep = ""))
> 
> library(mvtnorm)
> 
> # set up parallelization
> library(doFuture)
Loading required package: foreach
Loading required package: future
> library(parallel)
> registerDoFuture()
> nworkers = detectCores()
> plan(multisession, workers = nworkers)
> library(doRNG)
Loading required package: rngtools
> 
> gg_color_hue = function(n) {
+   hues = seq(15, 275, length = n + 1)
+   hcl(h = hues, l = 65, c = 100)[1:n]
+ }
> 
> ################################################################################
> # simulation settings, shared for both scenarios (sqexp vs. matern)
> ################################################################################
> 
> # simulations settings
> numSims = 100
> seed = 12
> Nin = 6
> numSeq = 15
> seqN = 1
> Nnew = numSeq * seqN
> Nttl = Nin + Nnew
> xmin = 0
> xmax = 1
> numx = 10^3 + 1
> x_seq = seq(from = xmin, to = xmax, length.out = numx)
> 
> # SeqMED settings
> nuggetSM = 1e-10
> 
> # boxhill settings
> prior_probs = rep(1 / 2, 2)
> nuggetBH = 1e-10
> 
> ################################################################################
> # input data
> ################################################################################
> 
> # 1. make space-filling design
> # space_filling = seq(from = xmin, to = xmax, length.out = Nttl)
> space_filling_idx = c(1, 1 + ((numx - 1)/(Nttl - 1)) * 1:((numx - 1) / ((numx - 1)/(Nttl - 1))))
> space_filling = x_seq[space_filling_idx]
> 
> # input set 1 (extrapolation)
> x_in1_idx = space_filling_idx[1:Nin]
> x_in1 = x_seq[x_in1_idx]
> x_spacefill1_idx = space_filling_idx[-c(1:Nin)]
> x_spacefill1 = x_seq[x_spacefill1_idx]
> # all.equal(space_filling, c(x_in1, x_spacefill1))
> 
> # input set 2 (increasing spread)
> x_in2_idx = space_filling_idx[c(1, 2, 4, 7, 12, 21)]
> x_in2 = x_seq[x_in2_idx]
> x_spacefill2_idx = space_filling_idx[-c(1, 2, 4, 7, 12, 21)]
> x_spacefill2 = x_seq[x_spacefill2_idx]
> # all.equal(space_filling, sort(c(x_in2, x_spacefill2)))
> 
> # input set 3 (space-filling / even coverage)
> x_in3_idx = c(1, 1 + ((numx - 1)/(Nin - 1)) * 1:((numx - 1) / ((numx - 1)/(Nin - 1))))
> x_in3 = x_seq[x_in3_idx]
> x_spacefill3_idx = space_filling_idx[!(space_filling_idx %in% x_in3_idx)]
> x_spacefill3 = x_seq[x_spacefill3_idx]
> # all.equal(space_filling, sort(c(x_in3, x_spacefill3)))
> 
> # input set 4 (uniform / random)
> 
> ################################################################################
> # Scenario 1: Squared exponential vs. matern, true = matern
> ################################################################################
> type01 = c("squaredexponential", "matern")
> l01= c(0.01, 0.01)
> # generate matern functions
> set.seed(seed)
> null_cov = getCov(x_seq, x_seq, type01[2], l01[2])
> null_mean = rep(0, numx)
> y_seq_mat = t(rmvnorm(n = numSims, mean = null_mean, sigma = null_cov)) # the function values
> 
> # bh settings
> model0 = list(type = type01[1], l = l01[1])
> model1 = list(type = type01[2], l = l01[2])
> 
> # generate seqmeds
> 
> # input set 2
> x_input = x_in2
> x_input_idx = x_in2_idx
> 
> registerDoRNG(1995)
> design_list = foreach(i = 1:numSims) %dorng% {
+   print(paste0("starting simulation ", i, " out of ", numSims))
+   y_seq = y_seq_mat[ , i]
+   y_input = y_seq[x_input_idx]
+   BHgp_m2(
+     y_input, x_input, x_input_idx, prior_probs, model0, model1, Nnew, 
+     x_seq, y_seq, nuggetBH)
+ }
[1] "starting simulation 1 out of 100"
[1] "starting simulation 2 out of 100"
[1] "starting simulation 3 out of 100"
[1] "starting simulation 4 out of 100"
[1] "starting simulation 5 out of 100"
[1] "starting simulation 6 out of 100"
[1] "starting simulation 7 out of 100"
[1] "starting simulation 8 out of 100"
[1] "starting simulation 9 out of 100"
[1] "starting simulation 10 out of 100"
[1] "starting simulation 11 out of 100"
[1] "starting simulation 12 out of 100"
[1] "starting simulation 13 out of 100"
[1] "starting simulation 14 out of 100"
[1] "starting simulation 15 out of 100"
[1] "starting simulation 16 out of 100"
[1] "starting simulation 17 out of 100"
[1] "starting simulation 18 out of 100"
[1] "starting simulation 19 out of 100"
[1] "starting simulation 20 out of 100"
[1] "starting simulation 21 out of 100"
[1] "starting simulation 22 out of 100"
[1] "starting simulation 23 out of 100"
[1] "starting simulation 24 out of 100"
[1] "starting simulation 25 out of 100"
[1] "starting simulation 26 out of 100"
[1] "starting simulation 27 out of 100"
[1] "starting simulation 28 out of 100"
[1] "starting simulation 29 out of 100"
[1] "starting simulation 30 out of 100"
[1] "starting simulation 31 out of 100"
[1] "starting simulation 32 out of 100"
[1] "starting simulation 33 out of 100"
[1] "starting simulation 34 out of 100"
[1] "starting simulation 35 out of 100"
[1] "starting simulation 36 out of 100"
[1] "starting simulation 37 out of 100"
[1] "starting simulation 38 out of 100"
[1] "starting simulation 39 out of 100"
[1] "starting simulation 40 out of 100"
[1] "starting simulation 41 out of 100"
[1] "starting simulation 42 out of 100"
[1] "starting simulation 43 out of 100"
[1] "starting simulation 44 out of 100"
[1] "starting simulation 45 out of 100"
[1] "starting simulation 46 out of 100"
[1] "starting simulation 47 out of 100"
[1] "starting simulation 48 out of 100"
[1] "starting simulation 49 out of 100"
[1] "starting simulation 50 out of 100"
[1] "starting simulation 51 out of 100"
[1] "starting simulation 52 out of 100"
[1] "starting simulation 53 out of 100"
[1] "starting simulation 54 out of 100"
[1] "starting simulation 55 out of 100"
[1] "starting simulation 56 out of 100"
[1] "starting simulation 57 out of 100"
[1] "starting simulation 58 out of 100"
[1] "starting simulation 59 out of 100"
[1] "starting simulation 60 out of 100"
[1] "starting simulation 61 out of 100"
[1] "starting simulation 62 out of 100"
[1] "starting simulation 63 out of 100"
[1] "starting simulation 64 out of 100"
[1] "starting simulation 65 out of 100"
[1] "starting simulation 66 out of 100"
[1] "starting simulation 67 out of 100"
[1] "starting simulation 68 out of 100"
[1] "starting simulation 69 out of 100"
[1] "starting simulation 70 out of 100"
[1] "starting simulation 71 out of 100"
[1] "starting simulation 72 out of 100"
[1] "starting simulation 73 out of 100"
[1] "starting simulation 74 out of 100"
[1] "starting simulation 75 out of 100"
[1] "starting simulation 76 out of 100"
[1] "starting simulation 77 out of 100"
[1] "starting simulation 78 out of 100"
[1] "starting simulation 79 out of 100"
[1] "starting simulation 80 out of 100"
[1] "starting simulation 81 out of 100"
[1] "starting simulation 82 out of 100"
[1] "starting simulation 83 out of 100"
[1] "starting simulation 84 out of 100"
[1] "starting simulation 85 out of 100"
[1] "starting simulation 86 out of 100"
[1] "starting simulation 87 out of 100"
[1] "starting simulation 88 out of 100"
[1] "starting simulation 89 out of 100"
[1] "starting simulation 90 out of 100"
[1] "starting simulation 91 out of 100"
[1] "starting simulation 92 out of 100"
[1] "starting simulation 93 out of 100"
[1] "starting simulation 94 out of 100"
[1] "starting simulation 95 out of 100"
[1] "starting simulation 96 out of 100"
[1] "starting simulation 97 out of 100"
[1] "starting simulation 98 out of 100"
[1] "starting simulation 99 out of 100"
[1] "starting simulation 100 out of 100"
> 
> save_list = list(
+   design.list = design_list, 
+   x0 = x_input,
+   x0.idx = x_input_idx, 
+   candidates = x_seq,
+   function.values.list = y_seq_mat, 
+   nugget = nuggetBH, 
+   type = type01, 
+   l = l01, 
+   numSeq = numSeq,
+   seqN = seqN
+ )
> saveRDS(save_list, 
+         paste(output_home, 
+               "/scenario1_boxhill_simulations", 
+               "_input2", 
+               "_Nin", Nin, 
+               "_Nnew", Nnew,
+               "_numSims", numSims, 
+               ".rds", sep = ""))
> 
> proc.time()
   user  system elapsed 
  8.084   1.023  75.963 
